settings:
  project_id: "weewar"
  color_logs: true
  color_scheme: "dark"
  prefix_logs: true
  prefix_max_length: 15
  default_debounce_delay: 2s

rules:
  # Go Backend Development & Testing
  - name: "backend"
    color: "blue"
    watch:
      - action: "exclude"
        patterns:
          - "**/*/*.log"
      - action: "include"
        patterns:
          - "web/**/*.go"
      - action: "exclude"
        patterns:
          - "web"
      - action: "include"
        patterns:
          - "service/**/*.go"
          - "**/*.go"
          - "go.mod"
          - "go.sum"
    commands:
      - "echo 'ðŸ”§ Building WeeWar Binary...'"
      - "make wasm"
      - "make binlocal"
      # - "go test -short ./..."
      - "echo 'âœ… Backend build and tests complete'"
      - "pkill weewar || true"
      # - "kill -9 `ps -ef | grep weewar  | sed -e \"s/  */:/g\" | cut -d ':' -f 3`"
      - "./bin/weewar serve"

  - name: "cli"
    color: "red"
    watch:
      - action: "include"
        patterns:
          - "lib/**/*.go"
          - "cmd/**/*.go"
          - "go.mod"
          - "go.sum"
    commands:
      - "echo 'ðŸ”§ Building WeeWar Binary...'"
      # - "make test"
      - "make wasm"
      - "make binlocal"
      - "make cli"

  # Frontend Development & Testing
  - name: "frontend"
    skip_run_on_init: true
    color: "green"
    workdir: "./web"
    watch:
      - action: "exclude"
        patterns:
          - "frontend/gen/**"
          - "**/*.log"
          - "node_modules/**"
          - "dist/**"
          - "test-results/**"
          - "playwright-report/**"
          - "node_modules"
      - action: "include"
        patterns:
          - "**/*.ts"
          - "**/*.css"
          - "**/*.html"
          - "**/*.spec.ts"
          - "**/*.test.ts"
          - "package.json"
          - "vite.config.ts"
          - "tsconfig.json"
    commands:
      - "echo 'âš¡ Building frontend...'"
      - "npm run build"
      - "echo 'ðŸ§ª Running frontend tests...'"
      # - "npm run test:unit"
      - "echo 'âœ… Frontend build complete and tests disabled'"

  # Protocol Buffers (affects both Go and Web)
  - name: "protobuf"
    color: "magenta"
    skip_run_on_init: true
    watch:
      - action: "include"
        patterns:
          - "protos/**/*.proto"
          - "buf.yaml"
          - "buf.gen.yaml"
    commands:
      - "echo 'ðŸ“¦ Regenerating Protocol Buffers...'"
      - "rm -Rf gen"
      - "buf generate"
      - "echo 'âœ… Protobuf generation complete'"
