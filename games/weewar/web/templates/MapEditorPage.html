<!-- templates/MapEditorPage.html -->
{{# include "BasePage.html" #}}

{{ define "ExtraHeaderButtons" }}
<!-- Save Button -->
<button id="save-map-btn" type="button"
    class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
    </svg>
    Save
</button>

<!-- Export Button -->
<button id="export-map-btn" type="button"
    class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-offset-gray-800">
    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
    </svg>
    Export
</button>
{{ end }}

{{ define "__ExtraHeadSection" }}
<style>
    /* Ensure dockview fills available space */
    #dockview-container {
        @apply h-full w-full;
    }
    
    /* Theme overrides for consistency */
    .dockview-theme-dark {
        --dv-background-color: theme('colors.gray.900');
        --dv-paneview-header-background: theme('colors.gray.800');
        --dv-tab-background: theme('colors.gray.800');
        --dv-tab-color: theme('colors.gray.400');
        --dv-activeTab-background: theme('colors.gray.700');
        --dv-activeTab-color: theme('colors.white');
        --dv-separator-border: theme('colors.gray.700');
        --dv-group-header-background: theme('colors.gray.800');
        --dv-group-header-border: theme('colors.gray.700');
    }
    
    /* Light theme support */
    .dockview-theme-light {
        --dv-background-color: theme('colors.gray.50');
        --dv-paneview-header-background: theme('colors.white');
        --dv-tab-background: theme('colors.white');
        --dv-tab-color: theme('colors.gray.600');
        --dv-activeTab-background: theme('colors.gray.100');
        --dv-activeTab-color: theme('colors.gray.900');
        --dv-separator-border: theme('colors.gray.200');
        --dv-group-header-background: theme('colors.white');
        --dv-group-header-border: theme('colors.gray.200');
    }
</style>
{{ end }}

{{ define "BodySection" }}
    <input id="mapIdInput" value="{{ .MapId }}" type="hidden" />
    <input id="isNewMap" value="{{ if .MapId }}false{{ else }}true{{ end }}" type="hidden" />
    
    <!-- Map Editor Container -->
    <main class="flex-1 flex flex-col bg-gray-50 dark:bg-gray-900 min-h-0">
        <!-- Editor Status Bar -->
        <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span id="editor-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                        Loading...
                    </span>
                    <span id="map-info" class="text-sm text-gray-600 dark:text-gray-400">
                        {{ if .Map.Name }}{{ .Map.Name }}{{ else }}New Map{{ end }}
                    </span>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="clear-console-btn" type="button" class="inline-flex items-center px-3 py-1 border border-gray-300 dark:border-gray-600 shadow-sm text-xs font-medium rounded text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                        Clear Console
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Dockview Container -->
        <div id="dockview-container" class="flex-1 min-h-0"></div>
        
        <!-- Hidden Panel Templates for Dockview -->
        <div style="display: none;">
            <div id="tools-panel-template">
                {{# include "panels/ToolsPanel.html" #}}
            </div>
            <div id="canvas-panel-template">
                {{# include "panels/PhaserPanel.html" #}}
            </div>
            <div id="console-panel-template">
                {{# include "panels/ConsolePanel.html" #}}
            </div>
            <div id="advanced-tools-panel-template">
                {{# include "panels/AdvancedToolsPanel.html" #}}
            </div>
        </div>
    </main>
{{ end }}

{{ define "PostBodySection" }}
<!-- WASM and Editor Scripts -->
<script src="/static/wasm/wasm_exec.js"></script>
<!-- Include generated JS for MapEditorPage -->
{{# include "gen/MapEditorPage.html" #}}
{{ end }}

{{ define "MapEditorPage" }}
{{ template "BasePage" . }}
{{ end }}
