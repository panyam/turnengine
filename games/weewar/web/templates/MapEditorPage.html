<!-- templates/MapEditorPage.html -->
{{# include "BasePage.html" #}}

{{ define "ExtraHeaderButtons" }}
<!-- Save Button -->
<button id="save-map-btn" type="button"
    class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
    </svg>
    Save
</button>

<!-- Export Button -->
<button id="export-map-btn" type="button"
    class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-offset-gray-800">
    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
    </svg>
    Export
</button>
{{ end }}

{{ define "BodySection" }}
    <input id="mapIdInput" value="{{ .MapId }}" type="hidden" />
    <input id="isNewMap" value="{{ if .MapId }}false{{ else }}true{{ end }}" type="hidden" />
    
    <!-- Map Editor Container -->
    <main class="flex-1 bg-gray-50 dark:bg-gray-900">
        <!-- Editor Status Bar -->
        <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span id="editor-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                        Loading...
                    </span>
                    <span id="map-info" class="text-sm text-gray-600 dark:text-gray-400">
                        {{ if .Map.Name }}{{ .Map.Name }}{{ else }}New Map{{ end }}
                    </span>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="validate-map-btn" type="button" class="inline-flex items-center px-3 py-1 border border-gray-300 dark:border-gray-600 shadow-sm text-xs font-medium rounded text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                        üîç Validate
                    </button>
                    <button id="clear-console-btn" type="button" class="inline-flex items-center px-3 py-1 border border-gray-300 dark:border-gray-600 shadow-sm text-xs font-medium rounded text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                        Clear Console
                    </button>
                </div>
            </div>
        </div>

        <!-- Editor Layout -->
        <div class="flex h-[calc(100vh-12rem)]">
            <!-- Left Sidebar: Tools and Controls -->
            <div class="w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 overflow-y-auto">
                <div class="p-4 space-y-6">
                    <!-- Map Management -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Map Management</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button data-action="create-new-map" data-width="5" data-height="5" class="px-3 py-2 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">New 5√ó5</button>
                            <button data-action="create-new-map" data-width="8" data-height="8" class="px-3 py-2 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">New 8√ó8</button>
                            <button data-action="create-new-map" data-width="8" data-height="12" class="px-3 py-2 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">New 8√ó12</button>
                            <button data-action="create-new-map" data-width="12" data-height="16" class="px-3 py-2 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">New 12√ó16</button>
                        </div>
                    </div>

                    <!-- Terrain Palette -->
                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">üé® Terrain Palette</h3>
                        <div class="grid grid-cols-3 gap-2">
                            <button class="terrain-button p-3 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" 
                                    data-terrain="0" title="Unknown">
                                <div class="text-lg">‚ùì</div>
                                <div class="text-xs">Unknown</div>
                            </button>
                            <button class="terrain-button p-3 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" 
                                    data-terrain="1" title="Grass">
                                <div class="text-lg">üå±</div>
                                <div class="text-xs">Grass</div>
                            </button>
                            <button class="terrain-button p-3 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" 
                                    data-terrain="2" title="Desert">
                                <div class="text-lg">üèúÔ∏è</div>
                                <div class="text-xs">Desert</div>
                            </button>
                            <button class="terrain-button p-3 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" 
                                    data-terrain="3" title="Water">
                                <div class="text-lg">üåä</div>
                                <div class="text-xs">Water</div>
                            </button>
                            <button class="terrain-button p-3 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" 
                                    data-terrain="4" title="Mountain">
                                <div class="text-lg">‚õ∞Ô∏è</div>
                                <div class="text-xs">Mountain</div>
                            </button>
                            <button class="terrain-button p-3 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" 
                                    data-terrain="5" title="Rock">
                                <div class="text-lg">üóø</div>
                                <div class="text-xs">Rock</div>
                            </button>
                        </div>
                    </div>

                    <!-- Brush Settings -->
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">üñåÔ∏è Brush Settings</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Brush Size:</label>
                                <select id="brush-size" 
                                        class="block w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                    <option value="0">Single (1 hex)</option>
                                    <option value="1">Small (7 hexes)</option>
                                    <option value="2">Medium (19 hexes)</option>
                                    <option value="3">Large (37 hexes)</option>
                                    <option value="4">X-Large (61 hexes)</option>
                                    <option value="5">XX-Large (91 hexes)</option>
                                </select>
                            </div>
                            <div id="brush-info" class="text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 p-2 rounded">
                                Current: Grass, Single brush (1 hex)
                            </div>
                        </div>
                    </div>

                    <!-- Painting Tools -->
                    <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">üéØ Painting Tools</h3>
                        <div class="space-y-3">
                            <div class="flex space-x-2">
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Row:</label>
                                    <input type="number" id="paint-row" placeholder="0" min="0" value="2"
                                           class="block w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                </div>
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Col:</label>
                                    <input type="number" id="paint-col" placeholder="0" min="0" value="2"
                                           class="block w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 gap-2">
                                <button data-action="paint-terrain" class="px-3 py-2 text-xs bg-green-600 text-white rounded hover:bg-green-700">üñåÔ∏è Paint</button>
                                <button data-action="flood-fill" class="px-3 py-2 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">üåä Flood Fill</button>
                                <button data-action="remove-terrain" class="px-3 py-2 text-xs bg-red-600 text-white rounded hover:bg-red-700">üóëÔ∏è Remove</button>
                            </div>
                        </div>
                    </div>

                    <!-- History Controls -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">‚Ü∂‚Ü∑ History</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button data-action="undo" id="undo-btn" class="px-3 py-2 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">‚Ü∂ Undo</button>
                            <button data-action="redo" id="redo-btn" class="px-3 py-2 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">‚Ü∑ Redo</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Editor Area -->
            <div class="flex-1 flex flex-col">
                <!-- Map Canvas Container with Resize Controls -->
                <div class="flex-1 bg-gray-100 dark:bg-gray-900 p-4">
                    <!-- Scrollable Canvas Container -->
                    <div id="canvas-viewport" class="relative w-full h-full bg-white dark:bg-gray-800 rounded-lg shadow-lg border-2 border-gray-300 dark:border-gray-600 overflow-auto">
                        
                        <!-- Top Add/Remove Controls (Fixed to Container) -->
                        <div class="absolute top-2 left-1/2 transform -translate-x-1/2 flex items-center space-x-2 z-10">
                            <button data-action="remove-row" data-side="top" class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors shadow-md" title="Remove top row">
                                ‚ñ≤ -
                            </button>
                            <button data-action="add-row" data-side="top" class="px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors shadow-md" title="Add row at top">
                                ‚ñ≤ +
                            </button>
                        </div>

                        <!-- Left Add/Remove Controls (Fixed to Container) -->
                        <div class="absolute left-2 top-1/2 transform -translate-y-1/2 flex flex-col items-center space-y-2 z-10">
                            <button data-action="remove-col" data-side="left" class="px-2 py-3 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors shadow-md writing-mode-vertical" title="Remove left column">
                                ‚óÄ -
                            </button>
                            <button data-action="add-col" data-side="left" class="px-2 py-3 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors shadow-md writing-mode-vertical" title="Add column on left">
                                ‚óÄ +
                            </button>
                        </div>

                        <!-- Right Add/Remove Controls (Fixed to Container) -->
                        <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex flex-col items-center space-y-2 z-10">
                            <button data-action="remove-col" data-side="right" class="px-2 py-3 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors shadow-md writing-mode-vertical" title="Remove right column">
                                - ‚ñ∂
                            </button>
                            <button data-action="add-col" data-side="right" class="px-2 py-3 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors shadow-md writing-mode-vertical" title="Add column on right">
                                + ‚ñ∂
                            </button>
                        </div>

                        <!-- Bottom Add/Remove Controls (Fixed to Container) -->
                        <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex items-center space-x-2 z-10">
                            <button data-action="remove-row" data-side="bottom" class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors shadow-md" title="Remove bottom row">
                                - ‚ñº
                            </button>
                            <button data-action="add-row" data-side="bottom" class="px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors shadow-md" title="Add row at bottom">
                                + ‚ñº
                            </button>
                        </div>

                        <!-- Map Canvas (Auto-sized by WASM) -->
                        <div id="editor-canvas-container" class="p-4 w-full h-full">
                            <canvas id="map-canvas" 
                                    width="320" 
                                    height="240"
                                    class="block cursor-crosshair bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600">
                            </canvas>
                        </div>
                    </div>
                </div>

                <!-- Console Output -->
                <div class="h-48 bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                    <div class="p-4">
                        <h4 class="text-sm font-medium text-gray-100 mb-2">Console Output</h4>
                        <div id="editor-output" class="bg-black text-green-400 font-mono text-xs p-3 rounded h-32 overflow-y-auto">
                            Map Editor loading...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar: Advanced Tools -->
            <div class="w-64 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 overflow-y-auto">
                <div class="p-4">
                    <!-- Advanced Tools -->
                    <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-3">üîß Advanced Tools</h3>
                        <div class="space-y-2">
                            <button data-action="fill-all-grass" class="w-full px-3 py-2 text-xs bg-green-600 text-white rounded hover:bg-green-700">üå± Fill All Grass</button>
                            <button data-action="create-test-pattern" class="w-full px-3 py-2 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">üé® Test Pattern</button>
                            <button data-action="create-island-map" class="w-full px-3 py-2 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">üèùÔ∏è Island Map</button>
                            <button data-action="create-mountain-ridge" class="w-full px-3 py-2 text-xs bg-gray-600 text-white rounded hover:bg-gray-700">‚õ∞Ô∏è Mountain Ridge</button>
                            <button data-action="show-terrain-stats" class="w-full px-3 py-2 text-xs bg-purple-600 text-white rounded hover:bg-purple-700">üìà Terrain Stats</button>
                            <button data-action="randomize-terrain" class="w-full px-3 py-2 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700">üé≤ Randomize</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
{{ end }}

{{ define "PostBodySection" }}
<!-- WASM and Editor Scripts -->
<script src="/static/wasm/wasm_exec.js"></script>
<!-- Include generated JS for MapEditorPage -->
{{# include "gen/MapEditorPage.html" #}}
{{ end }}

{{ define "MapEditorPage" }}
{{ template "BasePage" . }}
{{ end }}
