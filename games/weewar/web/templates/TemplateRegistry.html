<!-- FILE: web/views/templates/TemplateRegistry.html -->

<!-- Add this to index.html or create a new file -->
<div
  id="template-registry"
  style="display: none; position: absolute; visibility: hidden"
  aria-hidden="true"
>
  <!-- Store all modal templates here with data attributes -->
  <div data-template-id="section-type-selector">
    <!-- Header -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-5 border-b border-gray-200 dark:border-gray-600"
    >
      <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">
        Choose Section Type
      </h3>
    </div>

    <!-- Loading Indicator (Initially Hidden) -->
    <div
      id="suggest-loading-indicator"
      class="hidden p-6 text-center text-gray-500 dark:text-gray-400"
    >
      <svg
        class="animate-spin h-6 w-6 mx-auto"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      <p class="mt-2 text-sm">Thinking of suggestions...</p>
    </div>

    <!-- Standard Section Type Options -->
    <div
      id="standard-type-options"
      class="p-6 grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3"
    >
      <!-- Adjusted grid for smaller screens -->
      <!-- Text/Markdown Section -->
      <button
        data-section-type="text"
        class="section-type-option flex flex-col items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-8 w-8 text-blue-600 dark:text-blue-400 mb-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          />
        </svg>
        <span class="text-sm font-medium text-gray-900 dark:text-white"
          >Text</span
        >
        <span class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1"
          >Rich text with Markdown support</span
        >
      </button>

      <!-- Drawing Section -->
      <button
        data-section-type="drawing"
        class="section-type-option flex flex-col items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-8 w-8 text-blue-600 dark:text-blue-400 mb-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
          />
        </svg>
        <span class="text-sm font-medium text-gray-900 dark:text-white"
          >Drawing</span
        >
        <span class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1"
          >Architecture diagrams and flowcharts</span
        >
      </button>

      <!-- Plot Section -->
      <button
        data-section-type="plot"
        class="section-type-option flex flex-col items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-8 w-8 text-blue-600 dark:text-blue-400 mb-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"
          />
        </svg>
        <span class="text-sm font-medium text-gray-900 dark:text-white"
          >Plot</span
        >
        <span class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1"
          >Charts and data visualizations</span
        >
      </button>
      <!-- System Model Button -->
      <button
        data-section-type="system_description"
        class="section-type-option flex flex-col items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-8 w-8 text-purple-600 dark:text-purple-400 mb-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M17.25 6.75h-10.5l-1.125 1.125c-.59.59-.188 1.625.563 1.625h12.75c.75 0 1.153-1.035.563-1.625L17.25 6.75zm0 0V4.5m0 2.25V9m-10.5 0V4.5m0 4.5V9m1.125 5.625h8.25M10.875 14.625V18m2.25-3.375V18"
          />
          <path stroke-linecap="round" d="M12 16.5h.01" />
        </svg>
        <span class="text-sm font-medium text-gray-900 dark:text-white"
          >System Model</span
        >
        <span class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1"
          >Define components and interactions (DSL)</span
        >
      </button>
    </div>

    <!-- Suggest Sections Button -->
    <div class="p-6 pt-0 border-t border-gray-200 dark:border-gray-600">
      <button
        id="suggest-sections-btn"
        type="button"
        class="w-full mt-4 inline-flex items-center justify-center px-4 py-2 border border-dashed border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-300 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
          />
        </svg>
        Suggest Sections (AI)
      </button>
    </div>

    <!-- Container for Suggested Sections (Initially Hidden) -->
    <div
      id="suggested-sections-container"
      class="hidden p-6 border-t border-gray-200 dark:border-gray-600"
    >
      <h4 class="text-md font-medium text-gray-700 dark:text-gray-300 mb-3">
        Suggested Sections:
      </h4>
      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
        <!-- Suggested section cards will be appended here -->
      </div>
      <button
        id="show-standard-types-btn"
        type="button"
        class="mt-4 text-sm text-blue-600 dark:text-blue-400 hover:underline"
      >
        Show Standard Types
      </button>
    </div>

    <!-- Footer -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-gray-200 dark:border-gray-600"
    >
      <button
        id="section-type-cancel"
        type="button"
        class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-300 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
      >
        Cancel
      </button>
    </div>
  </div>

  <!-- Add other existing modal templates here if any (e.g., LlmDialog, LlmResults) -->
  <!-- Placeholder for LlmDialog (assuming it exists here or included elsewhere) -->
  <div data-template-id="llm-dialog">
    <!-- Header -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-5 border-b border-gray-200 dark:border-gray-600"
    >
      <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">
        Ask the LLM
      </h3>
    </div>

    <!-- Tabs -->
    <div class="border-b border-gray-200 dark:border-gray-700">
      <nav id="llm-dialog-tabs" class="flex -mb-px">
        <button
          data-tab-target="#llm-generate-content"
          class="llm-tab llm-tab-active border-blue-500 text-blue-600 dark:text-blue-400 dark:border-blue-400 whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm"
        >
          Generate
        </button>
        <button
          data-tab-target="#llm-custom-content"
          class="llm-tab text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 whitespace-nowrap py-4 px-6 border-b-2 border-transparent font-medium text-sm"
        >
          Custom
        </button>
        <button
          data-tab-target="#llm-verify-content"
          class="llm-tab llm-tab-verify text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 whitespace-nowrap py-4 px-6 border-b-2 border-transparent font-medium text-sm"
        >
          Verify
        </button>
      </nav>
    </div>

    <!-- Context Information -->
    <div
      class="bg-gray-50 dark:bg-gray-700 p-3 text-xs text-gray-500 dark:text-gray-400"
    >
      <div class="flex items-center">
        <span class="font-medium">Current section:</span>
        <span id="llm-current-section" class="ml-2">Requirements</span>
      </div>
    </div>

    <!-- Content Area -->
    <div class="p-6">
      <!-- Generate Tab Content -->
      <div id="llm-generate-content" class="llm-tab-pane">
        <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
          Generate content for this section using a pre-defined prompt
        </p>

        <div>
          <div class="flex items-center justify-between mb-1">
            <label
              for="llm-generate-prompt-input"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Generation Prompt:</label
            >
            <button
              id="llm-refresh-generate-prompt-btn"
              type="button"
              class="text-xs text-blue-600 dark:text-blue-400 hover:underline focus:outline-none flex items-center"
              title="Generate/refresh the default prompt for this section"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-3 w-3 mr-1"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2A8.001 8.001 0 0119.418 15m0 0h-5"
                />
              </svg>
              Refresh Default
            </button>
          </div>
          <textarea
            id="llm-generate-prompt-input"
            rows="6"
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white sm:text-sm font-mono text-xs whitespace-pre-wrap"
            placeholder="Enter or refresh the prompt to generate content..."
          ></textarea>
        </div>
      </div>

      <!-- Custom Tab Content -->
      <div id="llm-custom-content" class="llm-tab-pane hidden">
        <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
          Create your own prompt for the LLM
        </p>

        <div>
          <label
            for="custom-prompt"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >Your prompt</label
          >
          <textarea
            id="custom-prompt"
            rows="5"
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm"
            placeholder="Enter your custom prompt here..."
          ></textarea>
        </div>

        <!-- Include Context Checkboxes -->
        <div class="mt-4 hidden">
          <!-- Hide context for now -->
          <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Include context from:
          </p>
          <div class="space-y-2">
            <label class="inline-flex items-center">
              <input
                type="checkbox"
                class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600"
              />
              <span class="ml-2 text-sm text-gray-700 dark:text-gray-300"
                >Requirements (Section 1)</span
              >
            </label>
            <br />
            <label class="inline-flex items-center">
              <input
                type="checkbox"
                class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600"
              />
              <span class="ml-2 text-sm text-gray-700 dark:text-gray-300"
                >Data Model (Section 3)</span
              >
            </label>
          </div>
        </div>
      </div>

      <!-- Verify Tab Content -->
      <div id="llm-verify-content" class="llm-tab-pane hidden">
        <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
          Verify and analyze the content of this section
        </p>
        <div>
          <div class="flex items-center justify-between mb-1">
            <label
              for="llm-verify-prompt-input"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Verification Prompt:</label
            >
            <button
              id="llm-refresh-verify-prompt-btn"
              type="button"
              class="text-xs text-blue-600 dark:text-blue-400 hover:underline focus:outline-none flex items-center"
              title="Generate/refresh the default prompt for reviewing this section"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-3 w-3 mr-1"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2A8.001 8.001 0 0119.418 15m0 0h-5"
                />
              </svg>
              Refresh Default
            </button>
          </div>
          <textarea
            id="llm-verify-prompt-input"
            rows="6"
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white sm:text-sm font-mono text-xs whitespace-pre-wrap"
            placeholder="Enter or refresh the prompt to verify content..."
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Footer with Actions -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-gray-200 dark:border-gray-600"
    >
      <button
        id="llm-dialog-submit"
        type="button"
        data-modal-action="submit"
        class="inline-flex w-full justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm"
      >
        Submit
      </button>
      <button
        id="llm-dialog-cancel"
        type="button"
        class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-300 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
      >
        Cancel
      </button>
    </div>
  </div>
  <!-- Placeholder for LlmResults (assuming it exists here or included elsewhere) -->
  <div data-template-id="llm-results">
    <!-- Header -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-5 border-b border-gray-200 dark:border-gray-600"
    >
      <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">
        LLM Results
      </h3>
    </div>

    <!-- Results Content -->
    <div class="p-6 max-h-[60vh] overflow-y-auto">
      <!-- Add ID for results content area -->
      <div
        id="llm-results-content"
        class="prose dark:prose-invert max-w-none whitespace-pre-wrap"
      >
        <!-- LLM response will be inserted here -->
        <!-- whitespace-pre-wrap helps preserve formatting -->
      </div>
    </div>

    <!-- Footer with Actions -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-gray-200 dark:border-gray-600"
      id="llm-results-footer"
    >
      <!-- Apply Button (Initially hidden, shown by JS) -->
      <button
        id="llm-results-apply"
        type="button"
        data-modal-action="apply"
        class="hidden inline-flex w-full justify-center rounded-md border border-transparent bg-green-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm"
      >
        Apply to Section
      </button>
      <!-- **** END **** -->

      <!-- <button id="llm-revise" type="button" ...>Revise Prompt</button> -->
      <!-- **** Ensure ID exists **** -->
      <button
        id="llm-results-close"
        type="button"
        class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-300 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
      >
        Close
      </button>
      <!-- **** END **** -->
    </div>
  </div>

  <!-- ============================================ -->
  <!-- == NEW Section View/Edit Templates Start == -->
  <!-- ============================================ -->
  <hr class="my-6 border-gray-400 dark:border-gray-600" />

  <!-- == Text Section Templates == -->
  <div data-template-id="text-section-view">
    <!-- Root element takes full space of its container -->
    <div
      class="w-full h-full prose dark:prose-invert max-w-none section-view-content cursor-pointer"
      title="Click to edit"
    >
      <!-- Actual text content will be injected here by TextSection.ts -->
      <div
        id="toast-viewer-container"
        class="w-full h-full prose dark:prose-invert max-w-none p-1"
      ></div>
    </div>
  </div>

  <div data-template-id="text-section-edit">
    <!-- Root element takes full space and arranges children vertically -->
    <div class="w-full h-full flex flex-col section-edit-form">
      <!-- Container for Toast UI Editor -->
      <div
        id="toast-editor-container"
        class="flex-grow min-h-[300px] border border-gray-300 dark:border-gray-600 rounded-t-md"
      >
        <!-- Toast UI Editor will be initialized here -->
      </div>

      <!-- Edit controls (remain the same) -->
      <div
        class="edit-controls p-2 text-right space-x-2 border-t border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-b-md flex-shrink-0"
      >
        <button type="button" class="section-edit-cancel ...">Cancel</button>
        <button type="button" class="section-edit-save ...">Save</button>
      </div>
    </div>
  </div>

  <!-- == Drawing Section Templates == -->
  <div data-template-id="drawing-section-view">
    <!-- Root element takes full space, centers content, adds border -->
    <div
      class="w-full h-full flex flex-col items-center justify-center border border-dashed border-gray-300 dark:border-gray-600 rounded relative section-view-content p-4 min-h-[200px]"
    >
      <!-- Container for the drawing preview image/svg -->
      <div
        class="drawing-preview-container flex-grow w-full flex items-center justify-center overflow-auto"
      >
        <p class="text-gray-500 dark:text-gray-400 italic">
          View Mode: Drawing preview appears here.
        </p>
        <!-- e.g., <img src="..." alt="Drawing preview"> or SVG element -->
      </div>
      <!-- Edit button positioned top-right -->
      <button
        type="button"
        class="section-edit-trigger absolute top-2 right-2 px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md border border-gray-300 dark:border-gray-500 shadow-sm"
      >
        Edit
      </button>
    </div>
  </div>

  <div data-template-id="drawing-section-edit">
    <!-- Root element takes full space and arranges children vertically -->
    <div class="w-full h-full flex flex-col section-edit-form">
      <!-- Drawing library will attach to this container, it grows -->
      <!-- class="drawing-editor-container flex-grow border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900 rounded-t-md min-h-[300px] overflow-hidden" -->
      <div
        class="drawing-editor-container flex-grow border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 rounded-t-md h-[700px] overflow-hidden relative"
      >
        <p class="p-4 text-gray-500 dark:text-gray-400 italic">
          Edit Mode: Drawing editor loads here.
        </p>
      </div>
      <!-- Edit controls fixed at the bottom -->
      <div
        class="edit-controls p-2 text-right space-x-2 border-t border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-b-md"
      >
        <button
          type="button"
          class="section-edit-cancel px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Cancel
        </button>
        <button
          type="button"
          class="section-edit-save px-3 py-1 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- == Plot Section Templates == -->
  <div data-template-id="plot-section-view">
    <!-- Root element takes full space, centers content, adds border -->
    <div
      class="w-full h-full flex flex-col items-center justify-center border border-dashed border-gray-300 dark:border-gray-600 rounded relative section-view-content p-4 min-h-[200px]"
    >
      <!-- Container for the rendered plot -->
      <div
        class="plot-preview-container flex-grow w-full flex items-center justify-center overflow-auto"
      >
        <p class="text-gray-500 dark:text-gray-400 italic">
          View Mode: Plot appears here.
        </p>
        <!-- e.g., <canvas id="plot-canvas-..."></canvas> -->
      </div>
      <!-- Edit button positioned top-right -->
      <button
        type="button"
        class="section-edit-trigger absolute top-2 right-2 px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md border border-gray-300 dark:border-gray-500 shadow-sm"
      >
        Edit
      </button>
    </div>
  </div>

  <!-- System Description Section Templates -->
  <div data-template-id="system_description-section-view">
    <div class="w-full h-full section-view-content min-h-[150px] flex flex-col">
      <!-- View Mode Action Bar -->
      <div
        class="view-actions p-2 border-b border-gray-200 dark:border-gray-700 mb-2 flex items-center space-x-2 flex-shrink-0"
      >
        <button type="button" class="section-validate-dsl ...">
          Validate DSL
        </button>
        <!-- Keep this -->

        <!-- Change Generate button text -->
        <button
          type="button"
          class="section-generate-diagram px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm hover:bg-gray-200 dark:hover:bg-gray-500 flex items-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"
            />
          </svg>
          Generate/Refresh Diagram
        </button>
        <button type="button" class="section-run-analysis ..." disabled>
          Run Analysis
        </button>
        <!-- Keep disabled -->
      </div>

      <!-- Code Display Area -->
      <div class="flex-shrink-0 mb-4">
        <!-- Make code area non-growing initially -->
        <pre
          class="bg-gray-100 dark:bg-gray-900 p-4 rounded overflow-x-auto text-sm font-mono text-gray-800 dark:text-gray-200 max-h-80 overflow-y-auto"
        ><code class="language-dsl"></code></pre>
        <!-- Add max-h and overflow -->
      </div>

      <!-- Diagram Display Area (Initially hidden or showing placeholder) -->
      <div
        id="generated-diagram-container"
        class="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4 flex-grow flex flex-col items-center justify-center min-h-[200px]"
      >
        <!-- Use flex-grow -->
        <p class="text-gray-500 dark:text-gray-400 italic">
          Click "Generate/Refresh Diagram" to view.
        </p>
        <!-- Diagram SVG/Content will be inserted here by JS -->
      </div>

      <!-- Placeholder for analysis results (keep hidden) -->
      <div id="analysis-results-container" class="mt-4 border-t pt-4 hidden">
        Analysis Results Placeholder
      </div>
    </div>
  </div>

  <!-- Root element takes full space and arranges children vertically -->
  <div data-template-id="system_description-section-edit">
    <div class="w-full h-full flex flex-col section-edit-form">
      <!-- Textarea for DSL editing -->
      <textarea
        id="system-dsl-textarea"
        class="system-dsl-editor-target flex-grow border border-gray-300 dark:border-gray-600 rounded-t-md p-2 font-mono text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-blue-500 focus:border-blue-500 min-h-[300px] resize-y"
        aria-label="System Description Language editor"
        placeholder="Enter your system description DSL code here..."
      ></textarea>

      <!-- Edit controls fixed at the bottom -->
      <div
        class="edit-controls p-2 text-right space-x-2 border-t border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-b-md flex-shrink-0 flex justify-end items-center"
      >
        <button
          type="button"
          class="section-validate-dsl px-3 py-1 text-sm font-medium text-white bg-green-600 hover:bg-green-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 flex items-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 20 20"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          Validate DSL
        </button>
        <button
          type="button"
          class="section-edit-cancel px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Cancel
        </button>
        <button
          type="button"
          class="section-edit-save px-3 py-1 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Save
        </button>
      </div>
    </div>
  </div>

  <div data-template-id="plot-section-edit">
    <!-- Root element takes full space and arranges children vertically -->
    <div class="w-full h-full flex flex-col section-edit-form">
      <!-- Plot configuration editor area -->
      <div
        class="plot-editor-container flex-grow p-4 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-t-md min-h-[250px] overflow-auto"
      >
        <p class="text-gray-500 dark:text-gray-400 italic">
          Edit Mode: Plot configuration form/editor loads here.
        </p>
        <!-- e.g., <textarea placeholder="Plot JSON config..."></textarea> or form fields -->
      </div>
      <!-- Edit controls fixed at the bottom -->
      <div
        class="edit-controls p-2 text-right space-x-2 border-t border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-b-md"
      >
        <button
          type="button"
          class="section-edit-cancel px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Cancel
        </button>
        <button
          type="button"
          class="section-edit-save px-3 py-1 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Save
        </button>
      </div>
    </div>
  </div>

  <div data-template-id="system_description-section-view">
    <div class="w-full h-full section-view-content min-h-[150px]">
      <pre
        class="bg-gray-100 dark:bg-gray-900 p-4 rounded overflow-x-auto text-sm font-mono text-gray-800 dark:text-gray-200"
      ><code class="language-dsl"></code></pre>
    </div>
  </div>

  <div data-template-id="system_description-section-edit">
    <div class="w-full h-full flex flex-col section-edit-form">
      <div
        class="system-dsl-editor-target flex-grow border border-gray-300 dark:border-gray-600 rounded-t-md min-h-[300px] overflow-hidden"
        aria-label="System Description Language editor"
      ></div>
      <div
        class="edit-controls p-2 text-right space-x-2 border-t border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-b-md"
      >
        <button
          type="button"
          class="section-edit-cancel px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Cancel
        </button>
        <button
          type="button"
          class="section-edit-save px-3 py-1 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- == Template for Suggested Section Card == -->
  <div data-template-id="suggested-section-card">
    <button
      data-action="create-suggested"
      data-suggested-title=""
      data-suggested-type=""
      class="suggested-section-option flex flex-col items-start text-left w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-colors duration-150"
    >
      <div class="flex items-center mb-2">
        <!-- Icon placeholder (could be dynamic based on type later) -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 mr-2 text-blue-600 dark:text-blue-400 flex-shrink-0"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
          />
        </svg>
        <span
          class="suggested-section-title text-sm font-medium text-gray-900 dark:text-white"
        >
          Suggested Title
        </span>
        <span
          class="suggested-section-type ml-2 text-xs font-mono bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 px-1.5 py-0.5 rounded"
        >
          type
        </span>
      </div>
      <span
        class="suggested-section-description text-xs text-gray-500 dark:text-gray-400"
      >
        Suggestion description goes here.
      </span>
    </button>
  </div>
  <!-- == End Suggested Section Card Template == -->

  <!-- == NEW: Create Design Modal Template == -->
  <div data-template-id="create-design-modal">
    <!-- Header -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-5 border-b border-gray-200 dark:border-gray-600"
    >
      <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">
        Start a New Design
      </h3>
    </div>
    <!-- Content: Grid of options -->
    <div class="p-6 grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3">
      <!-- Blank Design Card -->
      <button
        data-action="create-blank"
        class="template-option-card flex flex-col items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-colors duration-150"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-10 w-10 text-blue-600 dark:text-blue-400 mb-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          />
        </svg>
        <span class="text-sm font-medium text-gray-900 dark:text-white"
          >Blank Design</span
        >
        <span class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1"
          >Start with an empty document.</span
        >
      </button>

      <!-- API Design Card -->
      <button
        data-action="create-from-template"
        data-template-id="api-design-v1"
        class="template-option-card flex flex-col items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-colors duration-150"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-10 w-10 text-green-600 dark:text-green-400 mb-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M17.25 6.75l-5.25 5.25m0 0l-5.25 5.25M12 12l5.25-5.25M12 12l5.25 5.25M12 12l-5.25 5.25M12 12l-5.25-5.25"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M19.5 12a7.5 7.5 0 11-15 0 7.5 7.5 0 0115 0z"
          />
        </svg>
        <span class="text-sm font-medium text-gray-900 dark:text-white"
          >API Design</span
        >
        <span class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1"
          >Includes Requirements, API Endpoints, Data Model, etc.</span
        >
      </button>

      <!-- Microservice Card -->
      <button
        data-action="create-from-template"
        data-template-id="microservice-v1"
        class="template-option-card flex flex-col items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-colors duration-150"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-10 w-10 text-purple-600 dark:text-purple-400 mb-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M8.25 9.75h7.5v7.5h-7.5z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M8.25 9.75V6a2.25 2.25 0 012.25-2.25h3A2.25 2.25 0 0118 6v3.75m-9.75 7.5V21a2.25 2.25 0 002.25 2.25h3a2.25 2.25 0 002.25-2.25v-3.75m3.75-7.5H21a2.25 2.25 0 012.25 2.25v3A2.25 2.25 0 0121 18h-1.5M3.75 17.25H3a2.25 2.25 0 01-2.25-2.25v-3A2.25 2.25 0 013 9h1.5"
          />
        </svg>
        <span class="text-sm font-medium text-gray-900 dark:text-white"
          >Microservice</span
        >
        <span class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1"
          >Sections for API, Data Store, Deployment, etc.</span
        >
      </button>

      <!-- Add more template cards here -->
    </div>
    <!-- Footer -->
    <div
      class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-gray-200 dark:border-gray-600"
    >
      <button
        id="create-design-cancel"
        type="button"
        class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-300 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
      >
        Cancel
      </button>
    </div>
  </div>
  <!-- == End: Create Design Modal Template == -->
</div>
